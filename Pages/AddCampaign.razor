@using BlazorApp.Data
@inject MarketingCampaignService MarketingCampaignService

<div class="simple-form">
    <form class="form">
        <div class="row p-0">
            <div class="col-lg-6">
                <div class="form-group">
                    <label for="movie-name">Movie Name</label>
                    <input @bind="@MarketingCampaign.Name" type="text" class="form-control" id="movie-name"/>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="form-group">
                    <label for="start-date">Start Date</label>
                    <input @bind="@MarketingCampaign.StartDate" type="date" class="form-control" id="start-date"/>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="form-group">
                    <label for="end-date">End Date</label>
                    <input @bind="@MarketingCampaign.EndDate" type="date" class="form-control" id="end-date"/>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="form-group">
                    <label for="end-date">Media</label>
                    <select class="form-select d-block w-100 p-3 py-1 border" @bind="@MarketingCampaign.MediaId">
                        @foreach (var media in _medias)
                        {
                            <option value="@media.Id">
                                @media.Name
                            </option>
                        }
                    </select>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="form-group">
                    <label for="end-date">Choose Advertiser</label>
                    <select class="form-select d-block w-100 p-3 py-1 border" @bind="@MarketingCampaign.AdvertiserId">
                        @foreach (var advertiser in _advertisers)
                        {
                            <option value="@advertiser.Id">
                                @advertiser.Name
                            </option>
                        }
                    </select>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="form-group">
                    <label for="end-date">Choose Publisher</label>
                    <select class="form-select d-block w-100 p-3 py-1 border" @bind="@MarketingCampaign.PublisherId">
                        @foreach (var publisher in _publisher)
                        {
                            <option value="@publisher.Id">
                                @publisher.Name
                            </option>
                        }
                    </select>
                </div>
            </div>

        </div>
    </form>

    <button @onclick="SaveMovie" class="btn btn-primary">Submit</button>
    <button @onclick="ModalInstance.CancelAsync" class="btn btn-secondary">Cancel</button>
</div>

@code {

    [CascadingParameter]
    BlazoredModalInstance ModalInstance { get; set; }

    private Data.Media[] _medias;
    private Data.Advertiser[] _advertisers;
    private Data.Publisher[] _publisher;

    protected override async Task OnInitializedAsync()
    {
        _medias = await MarketingCampaignService.GetMediasAsync();
        _advertisers = await MarketingCampaignService.GetAdvertisersAsync();
        _publisher = await MarketingCampaignService.GetPublishersAsync();
    }

    Data.MarketingCampaign MarketingCampaign { get; set; }

    protected override void OnInitialized()
    {
        MarketingCampaign = new Data.MarketingCampaign()
        {
            StartDate = DateTime.Now,
            EndDate = DateTime.Now.Add(new TimeSpan(5))
        };
    }

    void SaveMovie()
    {
        MarketingCampaignService.Add(MarketingCampaign);
    // ModalInstance.CloseAsync(ModalResult.Ok<MarketingCampaign>(MarketingCampaign));
    }

}